const admin = require('firebase-admin');

// Initialize Firebase Admin with error handling
try {
    const serviceAccount = {
        "type": "service_account",
        "project_id": "autopromote-464de",
        "private_key_id": "2960e43d20679d1cd0009fce9a41fbe3a326cf66",
        "private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCHGt/khS0utEYt\nU/4wD398CP2swMtKbaFmcA9BP7gLxpcOqavTdJ5qZA7gUPWxY7bUUVmV55o81g89\n3/hSGPCjwyh2eBYr3zF0ilmIs71ViFaysIqkmE6NLHOOskrjV5A/WIj7pqbHY5Ru\nJDchT7yU1RGL3Ra0ujt64KPZxtUSX9XCHsjyWtUxg67WkAGKsJ5LhpEb2XwnXqbN\nzgNKV+5NjjbwvLUgjYv0wA3s1HTQhU9+Wi+SYBeKYYESV4KaUa5g7VEAgvvJszaP\nKSxrG6ePlxboRUIXL2RPFkH3SKhpDtEt2i5H54ppwfJnXfaFoDHblb84PoJk1zMf\nGp965SxxAgMBAAECggEAH/9n7mXyNQECK+McLQLGpTg16E/C9e4wDyRUIJZ4PuW6\nSgE6Tjrs9/KZqVvTTL96gh+AMaYoG+dwta1RURRSDd7/OsunKJ3URy8rFFrJaTQA\noJJ6S5A87meMOMwWO3C2G6Ka0sr97fQyJ8HRAsUxOyiZXsAujAAdbTU96SqTtSWA\nUOAjxsA77MpLOivvhbaA0qdCLGCy0JSwa0XI7l5pAFuAWb9bbGUiZrJF5xLR5lP7\n1DB48bC5VwkYCBYcT/s++jM20MAsbMIC+I8f4cgBvKP83KedkGfWWotm4ptWbJ3b\nU3J5AL8FriivDCL5q+I0YtK2vJ5sKSaMnSYYanw66QKBgQC7g+4lB3oPd7NzH8m5\nITSMuIst9dKmSGe0TJAtEse9iJ3o+1Ly3HYUpu5Xs1haG9LXausF8ZxUqqhYsSHd\nP4V1nqKadZSl47q2MO5wEt7rfUSmZ/yOHaGMQwgrEFSAd4seLm2LMre6zYmJpYwj\nJ6n0EOu2UXvKfFP/rLiy32hphQKBgQC4cr8ZJ0BbKZv7e0fb4DHEFhXi9fNz42Bj\nfhRpHrGsh72NJf+yON33NkF10AxJ7HAhbxtkJLMeeSDKvpvGF56o59w9sn2Al5zB\nAyCcg6Y5phTUMTUdGjqU6+fNMZT/aXk13/u5nf90N9g70OLGj/aVUiV4InjIZF13\n4d19mSSU/QKBgCCdbuOD7GgaUt0YT1bi/qfnRVYGJtCDUX5bvswIMzO1OnoWlLPn\nQqaO7m/Uou5xXnfXge9zudREJqnejVxVOxpdMD0bbHJ6LLSZyC84KQveqv0ioxv4\n7WtfEWGkIn6BzHHAc489kBVuwJhvcfN/Z6Eq/ESm4ZgzjcyvtyRtlVSdAoGBAIxD\nDhklpSXt/WT++cU1twKDPP+LwyeUeB8QqJrLsZce3kEw7UHtRrYQdzUNEdtBRn/W\nSwEbe26n9AzZaAH6wjd1oiD008VvBdAs/aan4kciieJWzSolYPkQcAS1OLYF0hvr\nCTS89p69PN032svefEhO4Jl7tVfGIuHgS5uQUqZNAoGBAKzDkze/9VQCvHpyUI3y\nstW2fBragl9ivXx6rdgIV0nlu5e1VXZGzLL/P02qHKupdtiixoT5Xl1Kbujrlgdw\nmFpIAtBbFME67wZ/WsYHG56D2wzeAwzbSaF3XFxLfPqbtACOUz0uGEWK7B/O2Tfu\ne2lybXpmfnUmLIUkXzGUGIEf\n-----END PRIVATE KEY-----\n",
        "client_email": "firebase-adminsdk-fbsvc@autopromote-464de.iam.gserviceaccount.com",
        "client_id": "117319278547193053673",
        "auth_uri": "https://accounts.google.com/o/oauth2/auth",
        "token_uri": "https://oauth2.googleapis.com/token",
        "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
        "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-fbsvc%40autopromote-464de.iam.gserviceaccount.com",
        "universe_domain": "googleapis.com"
    };

    if (admin.apps.length === 0) {
        admin.initializeApp({
            credential: admin.credential.cert(serviceAccount)
        });
        console.log('âœ… Firebase Admin initialized successfully');
    }

    // Initialize Firestore with custom settings
    const db = admin.firestore();
    db.settings({
        ignoreUndefinedProperties: true,
        timestampsInSnapshots: true
    });

    // Initialize other services
    const auth = admin.auth();
    const storage = admin.storage();

    module.exports = { db, auth, storage, admin };
} catch (error) {
    console.error('Error initializing Firebase Admin:', error);
    process.exit(1);
}
