<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Mock TikTok OAuth Flow (Sandbox)</title>
  <style>body{font-family:Arial,Helvetica,sans-serif;padding:20px;background:#f9f9f9} .box{background:#fff;padding:16px;border-radius:8px;border:1px solid #e6e6e6;max-width:680px;margin:auto} button{cursor:pointer}</style>
</head>
<body>
  <div class="box">
    <h2>AutoPromote â€” Mock TikTok OAuth (Sandbox)</h2>
    <p>This local mock simulates the TikTok OAuth redirect URL and shows the authorize URL that would be used for the sandbox consent screen. Use this page when your network cannot reach sandbox.tiktok.com.</p>
    <div style="margin:12px 0">
      <label>Sandbox Client ID: <input id="clientId" value="SANDBOX_CLIENT_ID" style="width:70%"></label>
    </div>
    <div style="margin:12px 0">
      <label>Redirect URI: <input id="redirectUri" value="http://127.0.0.1:8081/tiktok-demo.html" style="width:70%"></label>
    </div>

    <div style="margin:12px 0">
      <button id="start" style="padding:8px 12px;border-radius:6px;background:#0b66ff;color:#fff;border:0">Show OAuth authorize URL</button>
      <button id="simulate" style="padding:8px 12px;border-radius:6px;background:#28a745;color:#fff;border:0;margin-left:8px">Simulate consent & redirect back</button>
    </div>

    <div id="log" style="margin-top:12px;font-family:monospace;white-space:pre-wrap;background:#f7f7f7;padding:8px;border-radius:6px;display:none"></div>
  </div>

  <script>
    // Prefill client id from query param if present
    (function(){
      try {
        const params = new URLSearchParams(window.location.search);
        const qKey = params.get('key') || params.get('client_key') || '';
        if (qKey) document.getElementById('clientId').value = qKey;
        const qRedirect = params.get('redirect_uri') || params.get('redirect') || '';
        if (qRedirect) document.getElementById('redirectUri').value = qRedirect;
      } catch(e){}
    })();

    const startBtn = document.getElementById('start');
    const simulateBtn = document.getElementById('simulate');

    startBtn.addEventListener('click', ()=>{
      const clientId = encodeURIComponent(document.getElementById('clientId').value.trim());
      const redirect = encodeURIComponent(document.getElementById('redirectUri').value.trim());
      const scope = encodeURIComponent('user.info.basic video.upload analytics.read');
      const state = encodeURIComponent('demo_state_123');
      const authUrl = `https://sandbox.tiktok.com/platform/oauth/authorize?client_key=${clientId}&response_type=code&scope=${scope}&redirect_uri=${redirect}&state=${state}`;
      const log = document.getElementById('log'); log.style.display='block'; log.textContent = 'Pretend redirect URL:\n' + authUrl + '\n\nYou can paste this URL into a browser tab (or show it in the recording) to illustrate the consent URL for reviewers.';
    });

    // Simulate consent and redirect back to the app with a fake code
    simulateBtn.addEventListener('click', ()=>{
      try {
        const clientId = encodeURIComponent(document.getElementById('clientId').value.trim());
        const redirect = document.getElementById('redirectUri').value.trim();
        const state = 'demo_state_123';
        const fakeCode = 'MOCK_CODE_ABC123';
        const sep = redirect.indexOf('?') === -1 ? '?' : '&';
        const redirectUrl = redirect + sep + 'code=' + encodeURIComponent(fakeCode) + '&state=' + encodeURIComponent(state) + '&client_key=' + clientId;
        window.location = redirectUrl;
      } catch(e){
        const log = document.getElementById('log'); log.style.display='block'; log.textContent = 'Failed to simulate redirect: ' + e;
      }
    });
  </script>
</body>
</html>
