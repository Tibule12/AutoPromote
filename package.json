{
  "$schema": "./package.schema.json",
  "name": "autopromote-server",
  "main": "src/server.js",
  "version": "1.0.0",
  "scripts": {
    "preflight": "node ./scripts/preflight-critical-files.js && node ./scripts/check-encryption-env.js && node ./autopromote-functions/validate-imports.js",
    "preflight:local": "node ./scripts/preflight-critical-files.js && node ./autopromote-functions/validate-imports.js",
    "validate-imports": "node ./autopromote-functions/validate-imports.js",
    "start": "node src/server.js",
    "start:dev": "NODE_ENV=development nodemon src/server.js",
    "test:unit": "node test/basic-sanity.js",
    "test:routes": "node test/route-imports.test.js",
    "test": "npm run test:unit",
    "test:jest": "cross-env FIREBASE_ADMIN_BYPASS=1 CI_ROUTE_IMPORTS=1 OPENAI_LOGGING_ENABLED=1 jest --runInBand --verbose --testTimeout=20000 --testPathIgnorePatterns=\"test/e2e/playwright/\"",
    "fetch:providers": "node scripts/fetch-provider-feeds.js",
    "test:unit:emulator": "node ./scripts/run-emulator-or-jest.js",
    "test:emulator": "npm run test:unit:emulator",
    "seed:emulator": "node ./scripts/seed-autopilot-emulator.js",
    "emulator:smoketest": "node ./scripts/seed-autopilot-emulator.js && node ./scripts/emulator-smoketest-run.js",
    "check:secrets": "node ./scripts/check-no-secrets.js",
    "test:e2e": "node test/e2e/upload-e2e.js",
    "test:e2e:playwright": "cross-env NODE_ENV=test CORS_ALLOW_ALL=true GOOGLE_APPLICATION_CREDENTIALS=test/e2e/tmp/service-account.json node ./scripts/write-service-account.js && npm --prefix frontend ci && npm --prefix frontend run build && cross-env NODE_ENV=test CORS_ALLOW_ALL=true GOOGLE_APPLICATION_CREDENTIALS=test/e2e/tmp/service-account.json npx playwright test test/e2e/playwright --config=test/e2e/playwright/playwright.config.js --workers=1",
    "test:e2e:playwright:emulator": "cross-env CORS_ALLOW_ALL=true npm --prefix frontend ci && npm --prefix frontend run build && npx playwright test test/e2e/playwright --config=test/e2e/playwright/playwright.config.js --workers=1",
    "lint": "node -e \"try{require('child_process').execSync('eslint --ext .js,.jsx src test --rule \"no-console:0\" --rule \"no-unused-vars:0\" --rule \"no-restricted-syntax:0\"', {stdio: 'inherit'})}catch(e){ /* swallow non-zero */ }\"",
    "emulator:start": "npx firebase emulators:start --only firestore,functions",
    "check:grpc-versions": "node -e \"const fs=require('fs'); const out=JSON.parse(require('child_process').execSync('npm ls @grpc/grpc-js --json').toString()||'{}'); const versions=new Set(); function scan(n){ if(!n||!n.dependencies) return; Object.keys(n.dependencies).forEach(k=>{ const d=n.dependencies[k]; if(k==='@grpc/grpc-js'){ versions.add(d.version); } scan(d); }); } scan(out); console.log('grpc versions:', [...versions].join(', ')); if(versions.size>1){ console.error('Multiple versions found'); process.exit(1);} \"",
    "check:grpc-install": "node ./scripts/check-grpc-install.js",
    "format": "prettier --write \"**/*.{js,jsx,json,css,md,html}\"",
    "format:check": "prettier --check \"**/*.{js,jsx,json,css,md,html}\"",
    "convert-recording": "node ./scripts/convert_webm_to_mp4.js",
    "convert-recording:hq": "node ./scripts/convert_webm_to_mp4.js --preset slow --crf 18",
    "prepare": "node -e \"const fs=require('fs'), cp=require('child_process'); const tryRun=(p)=>{ if(fs.existsSync(p)){ cp.execFileSync(process.execPath, [p], {stdio:'inherit'}); return true; } return false; }; if(tryRun('./scripts/ensure-husky.js')) process.exit(0); if(tryRun('../scripts/ensure-husky.js')) process.exit(0); if(tryRun('../../scripts/ensure-husky.js')) process.exit(0); console.log('No ensure-husky script found in CWD or parents; skipping husky install');\"",
    "verify:frontend-build": "node ./scripts/verify-frontend-build.js",
    "build:frontend": "npm --prefix frontend ci || (npm --prefix frontend install && npm --prefix frontend run build)"
  },
  "engines": {
    "node": ">=20"
  },
  "dependencies": {
    "@paypal/paypal-server-sdk": "^0.6.0",
    "@sendgrid/mail": "^8.1.4",
    "@sentry/node": "^7.72.0",
    "@sentry/react": "^7.120.4",
    "@sentry/tracing": "^7.72.0",
    "axios": "^1.13.2",
    "bcryptjs": "^2.4.3",
    "cors": "^2.8.5",
    "discord-interactions": "^4.4.0",
    "dotenv": "^16.6.1",
    "express": "^4.18.1",
    "express-rate-limit": "^6.8.0",
    "firebase": "^12.2.1",
    "firebase-admin": "^13.6.0",
    "fluent-ffmpeg": "^2.1.3",
    "form-data": "^4.0.1",
    "googleapis": "^160.0.0",
    "hono": "^4.11.4",
    "ioredis": "^5.3.2",
    "joi": "^18.0.1",
    "jsonwebtoken": "^9.0.2",
    "multer": "^2.0.2",
    "node-fetch": "^2.7.0",
    "nodemailer": "^7.0.11",
    "puppeteer": "^24.27.0",
    "resend": "^4.0.0",
    "streamifier": "^0.1.1",
    "undici": "^7.18.2",
    "uuid": "^13.0.0"
  },
  "overrides": {
    "@grpc/grpc-js": "1.14.0",
    "node-forge": "1.3.2",
    "serialize-javascript": "6.0.2",
    "qs": "6.14.1",
    "diff": "8.0.3",
    "braces": "3.0.3",
    "micromatch": "4.0.8"
  },
  "devDependencies": {
    "@babel/core": "^7.22.0",
    "@babel/preset-env": "^7.22.0",
    "@babel/preset-react": "^7.22.0",
    "@firebase/rules-unit-testing": "^5.0.0",
    "@playwright/test": "^1.42.0",
    "babel-jest": "^30.2.0",
    "cross-env": "^7.0.3",
    "eslint": "^8.44.0",
    "eslint-config-prettier": "^10.1.8",
    "ffmpeg-static": "^5.3.0",
    "firebase-tools": "^15.3.1",
    "husky": "^9.1.7",
    "jest": "^30.2.0",
    "jest-environment-jsdom": "^30.2.0",
    "lint-staged": "^16.2.7",
    "minimist": "^1.2.8",
    "nock": "^13.3.0",
    "prettier": "^3.7.4",
    "supertest": "^7.1.4"
  },
  "eslintConfig": {
    "root": true,
    "extends": [
      "prettier"
    ]
  },
  "lint-staged": {
    "frontend/**/*.{js,jsx}": [
      "prettier --write",
      "npm --prefix frontend run lint -- --fix"
    ],
    "src/**/*.{js,jsx}": [
      "prettier --write",
      "eslint --fix"
    ],
    "**/*.{json,md,css}": [
      "prettier --write"
    ]
  }
}
