jest.mock("../hashtagEngine", () => ({
  generateCustomHashtags: jest.fn(async ({ content, platform }) => ({
    hashtags: platform === "reddit" ? [] : ["#test1", "#test2"],
    hashtagString: platform === "reddit" ? "" : "#test1 #test2",
  })),
}));

const { optimizeForAlgorithm } = require("../algorithmExploitationEngine");

describe("algorithmExploitationEngine LinkedIn/Reddit support", () => {
  test("optimizeForAlgorithm generates hashtags for LinkedIn", async () => {
    const content = { title: "AI Case Study" };
    const res = await optimizeForAlgorithm(content, "linkedin", { generateHashtags: true });

    expect(res).toBeDefined();
    expect(res.hashtags).toBeDefined();
    expect(Array.isArray(res.hashtags.hashtags)).toBe(true);
    expect(res.hashtags.hashtags.length).toBeGreaterThan(0);
    expect(res.platform).toBe("linkedin");
  });

  test("optimizeForAlgorithm handles Reddit (no hashtags) gracefully", async () => {
    const content = { title: "Discussion about governance" };
    const res = await optimizeForAlgorithm(content, "reddit", { generateHashtags: true });

    expect(res).toBeDefined();
    expect(res.hashtags).toBeDefined();
    expect(Array.isArray(res.hashtags.hashtags)).toBe(true);
    // Our mock returns empty array for reddit
    expect(res.hashtags.hashtags.length).toBe(0);
    expect(res.platform).toBe("reddit");
  });
});
